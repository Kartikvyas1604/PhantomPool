# PhantomPool Redis Configuration
# Production-ready configuration for encrypted order book and real-time data

# Network and Security
bind 0.0.0.0
port 6379
protected-mode yes
requirepass phantom_pool_redis_secure_password_2024

# SSL/TLS Configuration (for production)
# tls-port 6380
# tls-cert-file /etc/redis/tls/redis.crt
# tls-key-file /etc/redis/tls/redis.key
# tls-ca-cert-file /etc/redis/tls/ca.crt

# Memory and Performance
maxmemory 4gb
maxmemory-policy allkeys-lru
maxmemory-samples 10

# Persistence for critical order data
save 900 1      # Save if at least 1 key changed in 900 seconds
save 300 10     # Save if at least 10 keys changed in 300 seconds  
save 60 10000   # Save if at least 10000 keys changed in 60 seconds

# RDB Configuration
rdbcompression yes
rdbchecksum yes
dbfilename phantom_pool_dump.rdb
dir /var/lib/redis

# AOF Configuration for maximum durability
appendonly yes
appendfilename "phantom_pool_appendonly.aof"
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Logging
loglevel notice
logfile /var/log/redis/phantom_pool_redis.log
syslog-enabled yes
syslog-ident phantom_pool_redis

# Client Configuration
timeout 300
tcp-keepalive 300
tcp-backlog 511

# Slow Log
slowlog-log-slower-than 10000
slowlog-max-len 128

# Advanced Settings
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_phantom_pool_secret"
rename-command DEBUG ""
rename-command EVAL ""
rename-command SCRIPT ""

# Module Configuration (if using RedisJSON, RedisTimeSeries, etc.)
# loadmodule /usr/lib/redis/modules/redistimeseries.so
# loadmodule /usr/lib/redis/modules/rejson.so

# Cluster Configuration (for horizontal scaling)
# cluster-enabled yes
# cluster-config-file nodes-6379.conf
# cluster-node-timeout 15000
# cluster-slave-validity-factor 10

# Memory Usage Optimization for Order Book
# Large hash tables for order storage
hash-max-ziplist-entries 1024
hash-max-ziplist-value 128

# Compression for large datasets
rdb-save-incremental-fsync yes

# Security Headers
# protected-mode yes
# user default on nopass ~* &* -@all +@read +@write +@connection +@transaction
# user phantom_pool_app on >secure_app_password_2024 ~phantom_pool:* +@all -@dangerous

# Monitoring and Stats
latency-monitor-threshold 100

# Custom Configuration for PhantomPool
# Order book key TTL (orders expire after 24 hours if not matched)
# This will be handled in the application layer with EXPIRE commands